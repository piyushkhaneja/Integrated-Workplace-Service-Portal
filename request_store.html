<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Request Store Items - JC Nexus Hub</title>
    
    <script src="https://cdn.tailwindcss.com?plugins=forms"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>

    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes animateGradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideOut {
            to { transform: translateX(100%); opacity: 0; }
        }

        .font-times { font-family: 'Times New Roman', Times, serif; }

        body {
            background: linear-gradient(-45deg, #eef2ff, #ede9fe, #dbeafe, #c7d2fe);
            background-size: 400% 400%;
            animation: animateGradient 15s ease infinite;
        }

        .input-wrapper { position: relative; }
        .input-underline {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background-color: #4f46e5; /* Indigo-600 */
            transform: scaleX(0);
            transform-origin: center;
            transition: transform 0.3s ease-out;
        }
        input:focus + .input-underline,
        select:focus + .input-underline,
        textarea:focus + .input-underline {
            transform: scaleX(1);
        }

        .toast.show { animation: slideIn 0.5s ease-out forwards; }
        .toast.hide { animation: slideOut 0.5s ease-in forwards; }
    </style>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Poppins', 'sans-serif'], },
                    animation: { 'fade-in': 'fadeIn 0.5s ease-out forwards', },
                    boxShadow: { 'pro': '0 25px 50px -12px rgb(0 0 0 / 0.1), 0 10px 10px -5px rgb(0 0 0 / 0.04)', }
                }
            }
        }
    </script>
</head>

<body class="antialiased">
    <div class="flex min-h-screen items-center justify-center p-4 md:p-6">
        <div class="w-full max-w-5xl">
            
            <div class="text-center mb-8 animate-fade-in" style="animation-delay: 100ms;">
                <img src="logo.png" alt="JC Nexus Hub Logo" class="h-20 md:h-24 w-auto mx-auto" />
                <h1 class="mt-2 text-2xl md:text-3xl font-bold tracking-wide text-slate-800 font-times">JC NEXUS HUB</h1>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-5 gap-6">

                <div class="lg:col-span-2 bg-white/70 backdrop-blur-xl p-8 rounded-2xl shadow-pro animate-fade-in" style="animation-delay: 200ms;">
                    <h2 class="text-2xl font-bold text-slate-900">Store & Stationery</h2>
                    <p class="mt-2 text-sm text-slate-600 leading-relaxed">Request essential items from the central store. Your request is logged in real-time for efficient inventory management and dispatch.</p>
                
                    <div class="mt-6 space-y-4">
                        <div class="flex items-start gap-4 p-4 bg-purple-50/70 border border-purple-200 rounded-xl">
                            <div class="flex-shrink-0 text-purple-600 text-xl pt-1">
                                <i class="fas fa-warehouse"></i>
                            </div>
                            <div>
                                <h3 class="font-semibold text-slate-800">Centralized Inventory</h3>
                                <p class="text-sm text-slate-600">All items are managed from a single source to ensure availability and quality control.</p>
                            </div>
                        </div>
                        <div class="flex items-start gap-4 p-4 bg-purple-50/70 border border-purple-200 rounded-xl">
                            <div class="flex-shrink-0 text-purple-600 text-xl pt-1">
                                <i class="fas fa-dolly"></i>
                            </div>
                            <div>
                                <h3 class="font-semibold text-slate-800">Efficient Distribution</h3>
                                <p class="text-sm text-slate-600">Our system ensures that your requests are processed promptly for quick delivery.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="lg:col-span-3 bg-white p-8 rounded-2xl shadow-pro animate-fade-in" style="animation-delay: 300ms;">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold text-slate-900">New Store Request</h2>
                        <span class="text-xs font-medium text-sky-700 bg-sky-100 py-1 px-3 rounded-full">
                            <i class="fas fa-boxes-stacked mr-1"></i> Live Inventory
                        </span>
                    </div>

                    <form id="storeRequestForm" class="space-y-5">
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-5">
                            <div>
                                <label for="floorNumber" class="text-sm font-medium text-slate-700">Floor Number</label>
                                <div class="input-wrapper mt-1">
                                    <input id="floorNumber" name="floorNumber" type="text" placeholder="e.g., 4th Floor" required class="block w-full border-0 border-b-2 border-slate-200 bg-slate-50 px-2 py-2 focus:ring-0 focus:border-indigo-600 transition" />
                                    <span class="input-underline"></span>
                                </div>
                            </div>
                            <div>
                                <label for="tableNumber" class="text-sm font-medium text-slate-700">Table / Desk Number</label>
                                <div class="input-wrapper mt-1">
                                    <input id="tableNumber" name="tableNumber" type="text" placeholder="e.g., 14B" required class="block w-full border-0 border-b-2 border-slate-200 bg-slate-50 px-2 py-2 focus:ring-0 focus:border-indigo-600 transition" />
                                    <span class="input-underline"></span>
                                </div>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-5">
                            <div>
                                <label for="itemName" class="text-sm font-medium text-slate-700">Item Name</label>
                                <div class="input-wrapper mt-1">
                                    <select id="itemName" name="itemName" required class="block w-full border-0 border-b-2 border-slate-200 bg-slate-50 px-2 py-2.5 focus:ring-0 focus:border-indigo-600 transition">
                                        <option value="" disabled selected>Select an item...</option>
                                        <option>Notebook</option>
                                        <option>Pen (Blue)</option>
                                        <option>Pen (Black)</option>
                                        <option>A4 Paper Ream</option>
                                        <option>Stapler & Pins</option>
                                        <option>Sticky Notes Pad</option>
                                        <option>Lab Coat</option>
                                        <option>Safety Cap</option>
                                        <option>ERP Gloves (Pair)</option>
                                        <option>ERP Slippers (Pair)</option>
                                        <option value="Other">Other (Please specify)</option>
                                    </select>
                                    <span class="input-underline"></span>
                                </div>
                            </div>
                            <div>
                                <label for="quantity" class="text-sm font-medium text-slate-700">Quantity</label>
                                <div class="input-wrapper mt-1">
                                    <input id="quantity" name="quantity" type="number" min="1" placeholder="e.g., 2" required class="block w-full border-0 border-b-2 border-slate-200 bg-slate-50 px-2 py-2 focus:ring-0 focus:border-indigo-600 transition" />
                                    <span class="input-underline"></span>
                                </div>
                            </div>
                        </div>
                        
                        <div id="otherItemWrapper" class="hidden">
                            <label for="otherItemName" class="text-sm font-medium text-slate-700">Please Specify Item</label>
                            <div class="input-wrapper mt-1">
                                <input id="otherItemName" name="otherItemName" type="text" placeholder="Type the item name here..." class="block w-full border-0 border-b-2 border-slate-200 bg-slate-50 px-2 py-2 focus:ring-0 focus:border-indigo-600 transition" />
                                <span class="input-underline"></span>
                            </div>
                        </div>

                        <div>
                            <label for="comments" class="text-sm font-medium text-slate-700">Additional Comments (Optional)</label>
                            <div class="input-wrapper mt-1">
                                <textarea id="comments" name="comments" rows="3" placeholder="e.g., Specific size for lab coat, or special instructions." class="block w-full border-0 border-b-2 border-slate-200 bg-slate-50 px-2 py-2 focus:ring-0 focus:border-indigo-600 transition resize-none"></textarea>
                                <span class="input-underline"></span>
                            </div>
                        </div>

                        <div id="message" aria-live="polite" class="text-center text-sm font-medium h-5 pt-1"></div>

                        <div class="flex items-center gap-4 pt-2">
                            <button type="submit" id="submitButton" class="group relative flex-grow flex justify-center items-center py-3 px-4 border border-transparent text-sm font-semibold rounded-lg text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-all duration-300 ease-in-out shadow-md hover:shadow-lg disabled:opacity-75 disabled:cursor-not-allowed">
                                <span class="button-text">Submit Request</span>
                                <span class="button-spinner absolute hidden">
                                    <svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                                </span>
                            </button>
                            <a href="/employee-dashboard" class="flex-shrink-0 text-sm font-medium text-slate-600 hover:text-indigo-600 transition">Back to Dashboard</a>
                        </div>
                    </form>
                </div>
            </div>

            <div class="mt-8 text-center animate-fade-in" style="animation-delay: 400ms;">
                <p class="text-xs text-slate-600">&copy; JC Eletronica pvt ltd. | All rights reserved.</p>
            </div>
        </div>
    </div>

    <div id="toast" class="fixed bottom-5 right-5 z-50 flex items-center gap-3 p-4 rounded-lg shadow-lg text-white opacity-0 translate-x-full transition-all duration-500">
        <span id="toast-icon" class="text-xl"></span>
        <p id="toast-message" class="text-sm font-medium"></p>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const storeRequestForm = document.getElementById('storeRequestForm');
            const messageDiv = document.getElementById('message');
            const submitButton = document.getElementById('submitButton');
            const buttonText = submitButton.querySelector('.button-text');
            const buttonSpinner = submitButton.querySelector('.button-spinner');
            const itemNameSelect = document.getElementById('itemName');
            const otherItemWrapper = document.getElementById('otherItemWrapper');
            const otherItemNameInput = document.getElementById('otherItemName');

            // --- Logic for 'Other' item selection ---
            itemNameSelect.addEventListener('change', () => {
                const isOther = itemNameSelect.value === 'Other';
                otherItemWrapper.classList.toggle('hidden', !isOther);
                otherItemNameInput.required = isOther;
            });

            function displayMessage(text, type = 'error') {
                messageDiv.textContent = text;
                messageDiv.className = `text-center text-sm font-medium h-5 pt-1 ${type === 'success' ? 'text-green-600' : 'text-red-600'}`;
            }
            
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toast-message');
            const toastIcon = document.getElementById('toast-icon');
            let toastTimeout;

            function showToast(message, type = 'error') {
                clearTimeout(toastTimeout);
                toast.classList.remove('bg-red-600', 'bg-green-600', 'hide');
                toast.classList.add('show');

                if (type === 'success') {
                    toast.classList.add('bg-green-600');
                    toastIcon.innerHTML = `<i class="fas fa-check-circle"></i>`;
                } else {
                    toast.classList.add('bg-red-600');
                    toastIcon.innerHTML = `<i class="fas fa-exclamation-circle"></i>`;
                }
                toastMessage.textContent = message;

                toastTimeout = setTimeout(() => {
                    toast.classList.remove('show');
                    toast.classList.add('hide');
                }, 3000);
            }

            storeRequestForm.addEventListener('submit', async function(event) {
                event.preventDefault();
                displayMessage('');
                
                const formData = new FormData(storeRequestForm);
                const data = Object.fromEntries(formData.entries());

                if (data.itemName === 'Other' && !data.otherItemName.trim()) {
                    showToast('Please specify the item name when selecting "Other".');
                    return;
                }
                
                // If 'Other' is selected, use the custom name
                if (data.itemName === 'Other') {
                    data.itemName = data.otherItemName;
                }
                delete data.otherItemName; // Clean up the object

                submitButton.disabled = true;
                buttonText.classList.add('opacity-0');
                buttonSpinner.classList.remove('hidden');

                try {
                    const response = await fetch('/api/store/requests', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data),
                    });

                    if (!response.ok) {
                        const errorResult = await response.json();
                        throw new Error(errorResult.message || 'Request failed to send.');
                    }
                    
                    showToast('Store request submitted successfully!', 'success');
                    storeRequestForm.reset();
                    otherItemWrapper.classList.add('hidden'); // Hide 'Other' field on reset

                    // --- AUTOMATIC REDIRECT ---
                    setTimeout(() => {
                        window.location.href = '/employee-dashboard';
                    }, 1500);

                } catch (error) {
                    showToast(error.message || 'An unexpected server error occurred.', 'error');
                } finally {
                    // Reset button state after a short delay to allow redirect
                    setTimeout(() => {
                        submitButton.disabled = false;
                        buttonText.classList.remove('opacity-0');
                        buttonSpinner.classList.add('hidden');
                    }, 1500);
                }
            });
        });
    </script>
</body>
</html>